# Inspector.mag
# Object inspector for Maggie IDE.
# Delegates to InspectorComponent for all inspection logic.

Inspector subclass: IDEToolBase
  instanceVars: inspectorComponent

  # Creation
  classMethod: inspect: anObject in: aSession [
      ^self new initializeFor: anObject in: aSession; open
  ]

  method: initializeFor: anObject in: aSession [
      | result |
      result := self initializeIn: aSession.
      inspectorComponent inspect: anObject.
      ^result
  ]

  method: buildUI [
      inspectorComponent := InspectorComponent in: session.

      # Main horizontal layout
      mainWidget := session createFlex.
      mainWidget direction: #row.
      mainWidget title: inspectorComponent title.
      mainWidget border: true.

      mainWidget addItem: inspectorComponent slotList proportion: 1.
      mainWidget addItem: inspectorComponent valueView proportion: 2.

      # Update title when navigation changes
      inspectorComponent onTitleChange: [:title | mainWidget title: title].

      self setupKeyBindings
  ]

  method: focusDefaultWidget [
      inspectorComponent focus
  ]

  method: setupKeyBindings [
      # Register key handler directly (not via setupBaseKeyBindings:) because
      # the VM has a known issue with invoking blocks passed as method arguments
      # from within closure contexts (nested block invocation bug).
      session onKey: [:event |
          event isCtrl ifTrue: [
              event rune = 'q' ifTrue: [self close]
          ].
          inspectorComponent handleKeyEvent: event
      ]
  ]

  method: printString [
      ^'Inspector'
  ]
